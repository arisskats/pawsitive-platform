generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id                String   @id @default(cuid())
  email             String   @unique
  password          String
  name              String?
  pushNotifications Boolean  @default(true)
  trustScore        Int      @default(0)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  pets              Pet[]
  communityAlerts   CommunityAlert[]
  communityComments CommunityComment[]
  verifications     Verification[]
  socialPosts       SocialPost[]
  socialComments    SocialPostComment[]
  socialReactions   SocialPostReaction[]
  socialActivities  SocialActivity[]
  actorActivities   SocialActivity[] @relation("SocialActivityActor")
}

model Pet {
  id            String   @id @default(cuid())
  name          String
  type          String
  breed         String?
  birthday      DateTime?
  weight        Float?
  ownerId       String
  owner         User     @relation(fields: [ownerId], references: [id])
  healthRecords HealthRecord[]
  foodAnalyses  FoodAnalysis[]
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model HealthRecord {
  id        String   @id @default(cuid())
  date      DateTime @default(now())
  type      String
  notes     String?
  petId     String
  pet       Pet      @relation(fields: [petId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model FoodAnalysis {
  id        String   @id @default(cuid())
  photoUrl  String
  result    Json
  petId     String
  pet       Pet      @relation(fields: [petId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Spot {
  id          String   @id @default(cuid())
  name        String
  description String?
  latitude    Float
  longitude   Float
  type        String
  rating      Float?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model CommunityAlert {
  id            String   @id @default(cuid())
  type          String
  title         String
  description   String?
  latitude      Float
  longitude     Float
  severity      Int      @default(1)
  authorId      String
  author        User     @relation(fields: [authorId], references: [id])
  verifications Verification[]
  comments      CommunityComment[]
  expiresAt     DateTime?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model CommunityComment {
  id        String   @id @default(cuid())
  text      String
  authorId  String
  author    User     @relation(fields: [authorId], references: [id])
  alertId   String
  alert     CommunityAlert @relation(fields: [alertId], references: [id])
  createdAt DateTime @default(now())
}

model Verification {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  alertId   String
  alert     CommunityAlert @relation(fields: [alertId], references: [id])
  isValid   Boolean  @default(true)
  createdAt DateTime @default(now())

  @@unique([userId, alertId])
}

model SocialPost {
  id          String   @id @default(cuid())
  content     String
  imageUrl    String?
  authorId    String
  author      User     @relation(fields: [authorId], references: [id])
  comments    SocialPostComment[]
  reactions   SocialPostReaction[]
  activities  SocialActivity[]
  reportCount Int      @default(0)
  isHidden    Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model SocialPostReaction {
  id        String   @id @default(cuid())
  postId    String
  post      SocialPost @relation(fields: [postId], references: [id])
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())

  @@unique([postId, userId])
}

model SocialActivity {
  id          String   @id @default(cuid())
  recipientId String
  recipient   User     @relation(fields: [recipientId], references: [id])
  actorId     String
  actor       User     @relation("SocialActivityActor", fields: [actorId], references: [id])
  postId      String
  post        SocialPost @relation(fields: [postId], references: [id])
  type        String
  isRead      Boolean  @default(false)
  createdAt   DateTime @default(now())
}

model SocialPostComment {
  id        String   @id @default(cuid())
  text      String
  postId    String
  post      SocialPost @relation(fields: [postId], references: [id])
  authorId  String
  author    User     @relation(fields: [authorId], references: [id])
  createdAt DateTime @default(now())
}
